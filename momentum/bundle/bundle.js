(()=>{"use strict";function e(e){let t=(new Date).toLocaleDateString(e,{weekday:"long",month:"long",day:"numeric"});t=t.split(" ").map((e=>e[0].toUpperCase()+e.slice(1))).join(" "),document.querySelector(".date").innerHTML=t}function t(){const e=new Date;document.querySelector(".time").innerHTML=e.toLocaleTimeString("ru")}const n=document.querySelector(".settings-btn"),a=document.querySelector(".settings-wrapper"),o=document.querySelectorAll(".settings-panels-list input"),r=function(){const e=(new Date).getHours();return Math.floor(e/6)}(),l=["night","morning","afternoon","evening"];let c={language:localStorage.getItem("language")?localStorage.getItem("language"):"en",photoSource:localStorage.getItem("photoSource")?localStorage.getItem("photoSource"):"github",tags:l[r],tagsApiContainer:localStorage.getItem("tagsApiContainer")?localStorage.getItem("tagsApiContainer"):"none",tagsApi:localStorage.getItem("tagsApi")?localStorage.getItem("tagsApi"):l[r],panels:JSON.parse(localStorage.getItem("panels"))?JSON.parse(localStorage.getItem("panels")):[{widget:"weather",shown:!0,en:"Weather",ru:"Погода"},{widget:"time",shown:!0,en:"Time",ru:"Время"},{widget:"date",shown:!0,en:"Date",ru:"Дата"},{widget:"greeting",shown:!0,en:"Greeting",ru:"Приветствие"},{widget:"quote",shown:!0,en:"Quote",ru:"Цитаты"},{widget:"player",shown:!0,en:"Player",ru:"Плеер"}]};function s(e){o.forEach((t=>{const n=c.panels.find((e=>e.widget===t.value));t.closest("label").firstElementChild.innerHTML="en"===e?n.en:n.ru}))}function i(e){document.querySelector(`.${e.target.value}-panel`).classList.toggle("panel-hidden"),e.target.checked?c.panels.find((t=>t.widget===e.target.value)).shown=!0:c.panels.find((t=>t.widget===e.target.value)).shown=!1}function u(e){document.querySelector(".settings-language h4").innerHTML="ru"===e?"Язык":"Language",document.querySelector(".settings-img h4").innerHTML="ru"===e?"Фотографии":"Photos",document.querySelector(".settings-panels h4").innerHTML="ru"===e?"Основные":"General",document.querySelector(".tag-error").innerHTML="ru"===e?"Тег должен содержать только латинские буквы и не более 15 символов":"The tag must contain only latin letters and no more than 15 characters"}o.forEach((e=>{const t=c.panels.find((t=>t.widget===e.value));e.checked=t.shown})),o.forEach((e=>{e.checked?(document.querySelector(`.${e.value}-panel`).classList.remove("panel-hidden"),c.panels.find((t=>t.widget===e.value)).shown=!0):(document.querySelector(`.${e.value}-panel`).classList.add("panel-hidden"),c.panels.find((t=>t.widget===e.value)).shown=!1)})),o.forEach((e=>{e.addEventListener("change",i)}));const d=[{night:{ru:"Доброй/Спокойной ночи",en:"Good night"}},{morning:{ru:"Доброе утро",en:"Good morning"}},{afternoon:{ru:"Добрый день",en:"Good afternoon"}},{evening:{ru:"Добрый вечер",en:"Good evening"}}],g=document.querySelector(".name");function m(e){let t=Object.values(d[r])[0];document.querySelector(".greeting").innerHTML=t[e]}function f(e){g.placeholder="ru"===e?"[Введите ваше имя]":"[Enter your name]"}let h=String((1,21,Math.floor(20*Math.random())+1));const p=c.tags;let v,S,y=c.tagsApi;const w=document.querySelector(".tag-img"),L=document.querySelector(".tag-container"),q=document.querySelector(".tag-error");function E(e){q.style.display=e,document.querySelectorAll(".tag-container span:not(:first-child)").forEach((t=>{localStorage.setItem("tagsApiContainer",e),c.tagsApiContainer=e,t.style.display=c.tagsApiContainer}))}function I(){return"github"===c.photoSource?(S=function(){const e=`https://raw.githubusercontent.com/irvelds/stage1-tasks/assets/images/${p}/${h.padStart(2,"0")}.jpg`;return v=e,e}(),w.disabled=!w.disabled,E("none")):"unsplash"===c.photoSource?(S=async function(){const e=`https://api.unsplash.com/photos/random?lang=en&orientation=landscape&query=${y}&client_id=ZtvWCVVtYpqIknQlYxjgcsgBx4sy-IEZV2M8RtD3tUs`,t=await fetch(e),n=await t.json();v=n.urls.regular,$()}(),w.disabled=!1,E("flex")):"flickr"===c.photoSource&&(S=async function(){const e=`https://www.flickr.com/services/rest/?method=flickr.photos.search&api_key=433d357743e76a7ff1fdd1796c3e244f&tags=${y}&extras=url_l&format=json&nojsoncallback=1`,t=await fetch(e),n=await t.json();console.log(n);const a=Math.round(Math.random()*n.photos.photo.length);v=n.photos.photo[a].url_l,$()}(),w.disabled=!1,E("flex")),S}function $(){const e=new Image;e.src=v,e.addEventListener("load",(()=>{document.querySelector("body").style.backgroundImage=`url('${v}')`}))}function b(){document.querySelectorAll(".close-tag").forEach((e=>{e.addEventListener("click",(e=>{e.target.parentNode.remove();const t=e.target.closest("span").textContent.slice(0,-1),n=localStorage.getItem("tagsApi").split(",").filter((e=>e!==t));localStorage.setItem("tagsApi",n),y=n.join(",")}))}))}I(),document.querySelector(".slide-next").addEventListener("click",(function(){h<20?h++:h=1,h=String(h),I(),$()})),document.querySelector(".slide-prev").addEventListener("click",(function(){h>1?h--:h=20,h=String(h),I(),$()})),window.addEventListener("load",(function(){w.addEventListener("change",(e=>{if(t=e.target,/^[a-zA-Z-]{0,20}$/g.test(t.value)&&e.target.value.length<20){let t=[];t.push(e.target.value.trim()),y=[y,...t].join(","),console.log(y),localStorage.setItem("tagsApi",y);let n=document.createElement("span");n.innerHTML=`${e.target.value}<button class="close-tag">x</button>`,L.appendChild(n),e.target.value="",q.textContent="",b()}else q.textContent="The tag must contain only latin letters and no more than 15 characters";var t}))})),window.addEventListener("load",(function(){localStorage.getItem("tagsApi")&&(y=[localStorage.getItem("tagsApi")].join(",")),new Set(y.split(",")).forEach((e=>{let t=document.createElement("span");t.innerHTML=`${e}<button class="close-tag">x</button>`,L.appendChild(t)})),E(c.tagsApiContainer)})),window.addEventListener("load",b);let k="",C=0,A="",M="";const x=document.querySelector(".quote"),T=document.querySelector(".author"),H=async function(){const e=await fetch("src/data.json");let t=await e.json();return k=Math.floor(Math.random()*t[0].length),C=t[0].length,console.log(C),console.log(t),t}().then((e=>e));function j(e,t){"ru"===e&&(A=t[0][k].textRu,M=t[0][k].authorRu),"en"===e&&(A=t[0][k].textEn,M=t[0][k].authorEn),x.innerHTML=`"${A}"`,T.innerHTML=M}function N(e){H.then((t=>{j(e,t)}))}const R=document.querySelector(".weather-icon"),D=document.querySelector(".temperature"),G=document.querySelector(".weather-description"),O=document.querySelector(".city"),W=document.querySelector(".humidity"),J=document.querySelector(".wind"),Y=document.querySelector(".weather-error");let _="",B="",F="";async function P(e){const t=`https://api.openweathermap.org/data/2.5/weather?q=${O.value}&lang=${e}&appid=40e213fbac776cc0243fd83571be2c75&units=metric`,n=await fetch(t),a=await n.json();console.log(a),200===a.cod?(R.className="weather-icon owf",R.classList.add(`owf-${a.weather[0].id}`),D.textContent=`${a.main.temp}°C`,G.textContent=a.weather[0].description,W.textContent=`${_}: ${a.main.humidity} %`,J.textContent=`${B}: ${a.wind.speed.toFixed(0)} ${F}`,V(a,e)):(V(a,e),R.className="weather-icon none owf",D.textContent="",G.textContent="",W.textContent="",J.textContent="")}function V(e,t){"city not found"===e.message||"Nothing to geocode"===e.message?Y.textContent="ru"===t?"Город не найден.":"City is not found. Please check spelling":Y.textContent=""}function Z(e){"Минск"!==O.value&&"Minsk"!==O.value||(O.value="ru"===e?"Минск":"Minsk"),P(c.language),_="ru"===e?"Относительная влажность":"Humidity",B="ru"===e?"Cкорость ветра":"Wind speed",F="ru"===e?"м/с":"m/s",O.placeholder="ru"===e?"[Введите город]":"[Enter the city]"}O.addEventListener("change",(function(e){P(c.language),O.blur(),localStorage.setItem("city",O.value)})),localStorage.getItem("city")&&(O.value=localStorage.getItem("city"));const Q=[{title:"Aqua Caelestis",src:"assets/sounds/AquaCaelestis.mp3",duration:"00:39"},{title:"Ennio Morricone",src:"assets/sounds/EnnioMorricone.mp3",duration:"01:37"},{title:"River Flows In You",src:"assets/sounds/RiverFlowsInYou.mp3",duration:"01:37"},{title:"Summer Wind",src:"assets/sounds/SummerWind.mp3",duration:"01:50"},{title:"Coda",src:"assets/sounds/Coda.mp3",duration:"02:43"}],U=document.querySelector(".play"),X=document.querySelector(".play-next"),z=document.querySelector(".play-prev"),K=document.querySelector(".play-list-container"),ee=document.querySelector(".play-track-name"),te=document.querySelector(".player-range");let ne=!1,ae=0;const oe=new Audio;for(let e=0;e<Q.length;e++){const t=document.createElement("li");t.classList.add("play-item"),t.textContent=Q[e].title,K.append(t)}const re=document.querySelectorAll(".play-item");function le(){ne?(U.classList.add("pause"),re.forEach((e=>e.classList.remove("playing"))),re[ae].classList.add("playing")):(U.classList.remove("pause"),re.forEach((e=>e.classList.remove("playing"))))}function ce(){oe.src=Q[ae].src,oe.play(),oe.currentTime=0,ne=!0,document.querySelectorAll(".play-item").forEach(((e,t)=>{t===ae?(ee.innerHTML=`${ae+1}. ${Q[ae].title}`,e.classList.add("item-active")):e.classList.remove("item-active")})),le()}function se(){ne?(oe.pause(),ne=!1,le()):ne||ce()}function ie(){console.log(ae),ae<Q.length-1?ae++:ae=0,ce()}function ue(e){const t=new Date(1e3*e).toISOString().substr(11,8);return{minutes:t.substr(3,2),seconds:t.substr(6,2)}}re.forEach(((e,t)=>e.addEventListener("click",(()=>{var e;(e=t)===ae?se():(ae=e,ce())})))),ee.innerHTML="1."+Q[0].title,re[0].classList.add("item-active"),oe.addEventListener("loadedmetadata",(function(){const e=ue(Math.round(oe.duration));te.setAttribute("max",Math.round(oe.duration)),document.querySelector(".play-track-duration").innerHTML=`${e.minutes}:${e.seconds}`,document.querySelector(".play-track-duration").setAttribute("datetime",`${e.minutes}m ${e.seconds}s`)})),oe.addEventListener("timeupdate",(function(){const e=ue(Math.round(oe.currentTime));document.querySelector(".play-track-current-time").innerHTML=`${e.minutes}:${e.seconds}`,document.querySelector(".play-track-current-time").setAttribute("datetime",`${e.minutes}m ${e.seconds}s`)})),oe.addEventListener("timeupdate",(function(){te.value=Math.floor(oe.currentTime);let e=Math.floor(oe.currentTime/oe.duration*100);te.style.background=`linear-gradient(to right, #c1ff06, 0%,  #c1ff06, ${e}%, #ffffff ${e}%)`}));const de=document.getElementById("player-tooltip");te.addEventListener("mousemove",(function(e){const t=Math.round(e.offsetX/e.target.clientWidth*parseInt(e.target.getAttribute("max"),10));te.setAttribute("data-seek",t);const n=ue(t);de.textContent=`${n.minutes}:${n.seconds}`;const a=oe.getBoundingClientRect();de.style.left=e.pageX-a.left+"px"})),te.addEventListener("input",(function(e){const t=e.target.dataset.playerRange?e.target.dataset.playerRange:e.target.value;oe.currentTime=t,te.value=t}));const ge=document.querySelector(".volume-button"),me=document.querySelectorAll(".volume-button use"),fe=document.querySelector('use[href="#volume-mute"]'),he=document.querySelector('use[href="#volume-low"]'),pe=document.querySelector('use[href="#volume-high"]'),ve=document.querySelector(".volume-range");ve.style.background=`linear-gradient(to right, #c1ff06, 0%,  #c1ff06, ${100*ve.value}%, #ffffff ${100*ve.value}%)`,ve.addEventListener("input",(function(){oe.muted&&(oe.muted=!1),oe.volume=ve.value,ve.style.background=`linear-gradient(to right, #c1ff06, 0%,  #c1ff06, ${100*ve.value}%, #ffffff ${100*ve.value}%)`})),ge.addEventListener("click",(function(){oe.muted=!oe.muted,oe.muted?(ve.setAttribute("data-volume",ve.value),ve.value=0,ve.style.background="linear-gradient(to right, #c1ff06, 0%,  #c1ff06, 0%, #ffffff 0%)"):(ve.value=ve.dataset.volume,ve.style.background=`linear-gradient(to right, #c1ff06, 0%,  #c1ff06, ${100*ve.value}%, #ffffff ${100*ve.value}%)`)})),oe.addEventListener("volumechange",(function(){me.forEach((e=>{e.classList.add("hidden")})),oe.muted||0===oe.volume?fe.classList.remove("hidden"):oe.volume>0&&oe.volume<=.5?he.classList.remove("hidden"):pe.classList.remove("hidden"),oe.muted&&0===oe.volume&&"0"===ve.dataset.volume&&(me.forEach((e=>{e.classList.add("hidden")})),he.classList.remove("hidden")),console.log(oe.muted)})),oe.addEventListener("ended",ie),z.addEventListener("click",(function(){console.log(ae),ae>0?ae--:ae=Q.length-1,ce()})),X.addEventListener("click",ie),U.addEventListener("click",se),document.querySelectorAll('[name="radio-lng"]').forEach((t=>{t.addEventListener("change",(t=>{c.language=t.target.value,e(c.language),m(c.language),f(c.language),N(c.language),Z(c.language),u(c.language),s(c.language)})),t.value===localStorage.getItem("language")&&(t.checked=!0)})),document.querySelectorAll('[name="widget-img"]').forEach((e=>{e.addEventListener("change",(e=>{c.photoSource=e.target.value,I(),$()})),e.value===localStorage.getItem("photoSource")&&(e.checked=!0)})),e(c.language),t(),setInterval((function(){t()}),1e3),m(c.language),window.addEventListener("beforeunload",(function(){localStorage.setItem("name",g.value)})),window.addEventListener("load",(function(){localStorage.getItem("name")&&(g.value=localStorage.getItem("name"))})),f(c.language),$(),N(c.language),document.querySelector(".change-quote").addEventListener("click",(e=>{var t;e.target.classList.toggle("active"),t=c.language,k++,k===C&&(k=0),H.then((e=>{j(t,e)}))})),Z(c.language),n.addEventListener("click",(e=>{e.target.classList.toggle("active"),a.classList.contains("active")?a.classList.remove("active"):a.classList.add("active")})),u(c.language),window.addEventListener("beforeunload",(function(){localStorage.setItem("language",c.language),localStorage.setItem("photoSource",c.photoSource),localStorage.setItem("panels",JSON.stringify(c.panels))})),window.addEventListener("load",(function(){localStorage.getItem("language")&&(c.language=localStorage.getItem("language")),localStorage.getItem("photoSource")&&(c.photoSource=localStorage.getItem("photoSource")),localStorage.getItem("panels")&&(c.panels=JSON.parse(localStorage.getItem("panels")))})),s(c.language)})();