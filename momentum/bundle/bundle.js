(()=>{"use strict";function e(e){let t=(new Date).toLocaleDateString(e,{weekday:"long",month:"long",day:"numeric"});t=t.split(" ").map((e=>e[0].toUpperCase()+e.slice(1))).join(" "),document.querySelector(".date").innerHTML=t}function t(){const e=new Date;document.querySelector(".time").innerHTML=e.toLocaleTimeString("ru")}const n=document.querySelector(".settings-btn"),o=document.querySelector(".settings-wrapper"),a=document.querySelectorAll(".settings-panels-list input");document.querySelectorAll(".settings-widget"),document.body.addEventListener("click",(e=>{e.target.closest(".settings-wrapper")||o.classList.remove("active")}));const l=function(){const e=(new Date).getHours();return Math.floor(e/6)}(),c=["night","morning","afternoon","evening"];let r={language:localStorage.getItem("language")?localStorage.getItem("language"):"en",photoSource:localStorage.getItem("photoSource")?localStorage.getItem("photoSource"):"github",tags:c[l],tagsApiContainer:localStorage.getItem("tagsApiContainer")?localStorage.getItem("tagsApiContainer"):"none",tagsApi:localStorage.getItem("tagsApi")?localStorage.getItem("tagsApi"):c[l],panels:JSON.parse(localStorage.getItem("panels"))?JSON.parse(localStorage.getItem("panels")):[{widget:"time",shown:!0,en:"Time",ru:"Время"},{widget:"date",shown:!0,en:"Date",ru:"Дата"},{widget:"greeting",shown:!0,en:"Greeting",ru:"Приветствие"},{widget:"quote",shown:!0,en:"Quote",ru:"Цитаты"},{widget:"weather",shown:!0,en:"Weather",ru:"Погода"},{widget:"player",shown:!0,en:"Player",ru:"Плеер"},{widget:"todo",shown:!0,en:"Todo",ru:"Список дел"}]};function s(e){a.forEach((t=>{const n=r.panels.find((e=>e.widget===t.value));t.closest("label").firstElementChild.innerHTML="en"===e?n.en:n.ru}))}function i(e){document.querySelector(`.${e.target.value}-panel`).classList.toggle("panel-hidden"),e.target.checked?r.panels.find((t=>t.widget===e.target.value)).shown=!0:r.panels.find((t=>t.widget===e.target.value)).shown=!1}function d(e){document.querySelector(".settings-language h4").innerHTML="ru"===e?"Язык":"Language",document.querySelector(".settings-img h4").innerHTML="ru"===e?"Фотографии":"Photos",document.querySelector(".settings-panels h4").innerHTML="ru"===e?"Основные":"General"}a.forEach((e=>{const t=r.panels.find((t=>t.widget===e.value));t.shown&&(e.checked=t.shown)})),a.forEach((e=>{e.checked?(document.querySelector(`.${e.value}-panel`).classList.remove("panel-hidden"),r.panels.find((t=>t.widget===e.value)).shown=!0):(document.querySelector(`.${e.value}-panel`).classList.add("panel-hidden"),r.panels.find((t=>t.widget===e.value)).shown=!1)})),a.forEach((e=>{e.addEventListener("change",i)}));const u=[{night:{ru:"Доброй/Спокойной ночи",en:"Good night"}},{morning:{ru:"Доброе утро",en:"Good morning"}},{afternoon:{ru:"Добрый день",en:"Good afternoon"}},{evening:{ru:"Добрый вечер",en:"Good evening"}}],g=document.querySelector(".name");function m(e){let t=Object.values(u[l])[0];document.querySelector(".greeting").innerHTML=t[e]}function p(e){g.placeholder="ru"===e?"[Введите ваше имя]":"[Enter your name]"}let h=String((1,21,Math.floor(20*Math.random())+1));const f=r.tags;let S,v,y=r.tagsApi;const L=document.querySelector(".tag-img"),w=document.querySelector(".tag-container"),E=document.querySelector(".tag-error");function I(e){E.style.display=e,document.querySelectorAll(".tag-container span:not(:first-child)").forEach((t=>{localStorage.setItem("tagsApiContainer",e),r.tagsApiContainer=e,t.style.display=r.tagsApiContainer}))}function q(){return"github"===r.photoSource?(v=function(){const e=`https://raw.githubusercontent.com/irvelds/stage1-tasks/assets/images/${f}/${h.padStart(2,"0")}.jpg`;return S=e,e}(),L.disabled=!L.disabled,I("none")):"unsplash"===r.photoSource?(v=async function(){const e=`https://api.unsplash.com/photos/random?lang=en&orientation=landscape&query=${y}&client_id=ZtvWCVVtYpqIknQlYxjgcsgBx4sy-IEZV2M8RtD3tUs`,t=await fetch(e),n=await t.json();S=n.urls.regular,b()}(),L.disabled=!1,I("flex")):"flickr"===r.photoSource&&(v=async function(){const e=`https://www.flickr.com/services/rest/?method=flickr.photos.search&api_key=433d357743e76a7ff1fdd1796c3e244f&tags=${y}&extras=url_l&format=json&nojsoncallback=1`,t=await fetch(e),n=await t.json(),o=Math.round(Math.random()*n.photos.photo.length);S=n.photos.photo[o].url_l,b()}(),L.disabled=!1,I("flex")),v}function b(){const e=new Image;e.src=S,e.addEventListener("load",(()=>{document.querySelector("body").style.backgroundImage=`url('${S}')`}))}function k(){document.querySelectorAll(".close-tag").forEach((e=>{e.addEventListener("click",(e=>{e.target.parentNode.remove();const t=e.target.closest("span").textContent.slice(0,-1),n=localStorage.getItem("tagsApi").split(",").filter((e=>e!==t));localStorage.setItem("tagsApi",n),y=n.join(","),e.stopPropagation()}))}))}function $(e){E.textContent="ru"===e?"Тег должен содержать только латинские буквы и не более 15 символов":"The tag must contain only latin letters and no more than 15 characters"}q(),document.querySelector(".slide-next").addEventListener("click",(function(){h<20?h++:h=1,h=String(h),q(),b()})),document.querySelector(".slide-prev").addEventListener("click",(function(){h>1?h--:h=20,h=String(h),q(),b()})),window.addEventListener("load",(function(){L.addEventListener("change",(e=>{if(t=e.target,/^[a-zA-Z-]{0,20}$/g.test(t.value)&&e.target.value.length<20){let t=[];t.push(e.target.value.trim()),y=[y,...t].join(","),localStorage.setItem("tagsApi",y);let n=document.createElement("span");n.innerHTML=`${e.target.value}<button class="close-tag">x</button>`,w.appendChild(n),e.target.value="",E.textContent="",k()}else $(r.language);var t}))})),window.addEventListener("load",(function(){localStorage.getItem("tagsApi")&&(y=[localStorage.getItem("tagsApi")].join(",")),new Set(y.split(",")).forEach((e=>{let t=document.createElement("span");t.innerHTML=`${e}<button class="close-tag">x</button>`,w.appendChild(t)})),I(r.tagsApiContainer)})),window.addEventListener("load",k);let x="",A=0,T="",C="";const M=document.querySelector(".quote"),N=document.querySelector(".author"),O=async function(){const e=await fetch("src/data.json");let t=await e.json();return x=Math.floor(Math.random()*t[0].length),A=t[0].length,t}().then((e=>e));function H(e,t){"ru"===e&&(T=t[0][x].textRu,C=t[0][x].authorRu),"en"===e&&(T=t[0][x].textEn,C=t[0][x].authorEn),M.innerHTML=`"${T}"`,N.innerHTML=C}function J(e){O.then((t=>{H(e,t)}))}const j=document.querySelector(".weather-icon"),D=document.querySelector(".temperature"),R=document.querySelector(".weather-description"),G=document.querySelector(".city"),W=document.querySelector(".humidity"),P=document.querySelector(".wind"),Y=document.querySelector(".weather-error");let _="",B="",F="";async function V(e){const t=`https://api.openweathermap.org/data/2.5/weather?q=${G.value}&lang=${e}&appid=40e213fbac776cc0243fd83571be2c75&units=metric`,n=await fetch(t),o=await n.json();200===o.cod?(j.className="weather-icon owf",j.classList.add(`owf-${o.weather[0].id}`),D.textContent=`${o.main.temp}°C`,R.textContent=o.weather[0].description,W.textContent=`${_}: ${o.main.humidity} %`,P.textContent=`${B}: ${o.wind.speed.toFixed(0)} ${F}`,Z(o,e)):(Z(o,e),j.className="weather-icon none owf",D.textContent="",R.textContent="",W.textContent="",P.textContent="")}function Z(e,t){"city not found"===e.message||"Nothing to geocode"===e.message?Y.textContent="ru"===t?"Город не найден.":"City is not found. Please check spelling":Y.textContent=""}function Q(e){"Минск"!==G.value&&"Minsk"!==G.value||(G.value="ru"===e?"Минск":"Minsk"),V(r.language),_="ru"===e?"Относительная влажность":"Humidity",B="ru"===e?"Cкорость ветра":"Wind speed",F="ru"===e?"м/с":"m/s",G.placeholder="ru"===e?"[Введите город]":"[Enter the city]"}G.addEventListener("change",(function(e){V(r.language),G.blur(),localStorage.setItem("city",G.value)})),localStorage.getItem("city")&&(G.value=localStorage.getItem("city"));const U=[{title:"Aqua Caelestis",src:"assets/sounds/AquaCaelestis.mp3",duration:"00:39"},{title:"Ennio Morricone",src:"assets/sounds/EnnioMorricone.mp3",duration:"01:37"},{title:"River Flows In You",src:"assets/sounds/RiverFlowsInYou.mp3",duration:"01:37"},{title:"Summer Wind",src:"assets/sounds/SummerWind.mp3",duration:"01:50"},{title:"Coda",src:"assets/sounds/Coda.mp3",duration:"02:43"}],X=document.querySelector(".play"),z=document.querySelector(".play-next"),K=document.querySelector(".play-prev"),ee=document.querySelector(".play-list-container"),te=document.querySelector(".play-track-name"),ne=document.querySelector(".player-range");let oe=!1,ae=0;const le=new Audio;for(let e=0;e<U.length;e++){const t=document.createElement("li");t.classList.add("play-item"),t.textContent=U[e].title,ee.append(t)}const ce=document.querySelectorAll(".play-item");function re(){oe?(X.classList.add("pause"),ce.forEach((e=>e.classList.remove("playing"))),ce[ae].classList.add("playing")):(X.classList.remove("pause"),ce.forEach((e=>e.classList.remove("playing"))))}function se(){le.src=U[ae].src,le.play(),le.currentTime=0,oe=!0,document.querySelectorAll(".play-item").forEach(((e,t)=>{t===ae?(te.innerHTML=`${ae+1}. ${U[ae].title}`,e.classList.add("item-active")):e.classList.remove("item-active")})),re()}function ie(){oe?(le.pause(),oe=!1,re()):oe||se()}function de(){ae<U.length-1?ae++:ae=0,se()}function ue(e){const t=new Date(1e3*e).toISOString().substr(11,8);return{minutes:t.substr(3,2),seconds:t.substr(6,2)}}ce.forEach(((e,t)=>e.addEventListener("click",(()=>{var e;(e=t)===ae?ie():(ae=e,se())})))),te.innerHTML="1."+U[0].title,ce[0].classList.add("item-active"),le.addEventListener("loadedmetadata",(function(){const e=ue(Math.round(le.duration));ne.setAttribute("max",Math.round(le.duration)),document.querySelector(".play-track-duration").innerHTML=`${e.minutes}:${e.seconds}`,document.querySelector(".play-track-duration").setAttribute("datetime",`${e.minutes}m ${e.seconds}s`)})),le.addEventListener("timeupdate",(function(){const e=ue(Math.round(le.currentTime));document.querySelector(".play-track-current-time").innerHTML=`${e.minutes}:${e.seconds}`,document.querySelector(".play-track-current-time").setAttribute("datetime",`${e.minutes}m ${e.seconds}s`)})),le.addEventListener("timeupdate",(function(){ne.value=Math.floor(le.currentTime);let e=Math.floor(le.currentTime/le.duration*100);ne.style.background=`linear-gradient(to right, #c1ff06, 0%,  #c1ff06, ${e}%, #ffffff ${e}%)`}));const ge=document.getElementById("player-tooltip");ne.addEventListener("mousemove",(function(e){const t=Math.round(e.offsetX/e.target.clientWidth*parseInt(e.target.getAttribute("max"),10));ne.setAttribute("data-seek",t);const n=ue(t);ge.textContent=`${n.minutes}:${n.seconds}`;const o=le.getBoundingClientRect();ge.style.left=e.pageX-o.left+"px"})),ne.addEventListener("input",(function(e){const t=e.target.dataset.playerRange?e.target.dataset.playerRange:e.target.value;le.currentTime=t,ne.value=t}));const me=document.querySelector(".volume-button"),pe=document.querySelectorAll(".volume-button use"),he=document.querySelector('use[href="#volume-mute"]'),fe=document.querySelector('use[href="#volume-low"]'),Se=document.querySelector('use[href="#volume-high"]'),ve=document.querySelector(".volume-range");ve.style.background=`linear-gradient(to right, #c1ff06, 0%,  #c1ff06, ${100*ve.value}%, #ffffff ${100*ve.value}%)`,ve.addEventListener("input",(function(){le.muted&&(le.muted=!1),le.volume=ve.value,ve.style.background=`linear-gradient(to right, #c1ff06, 0%,  #c1ff06, ${100*ve.value}%, #ffffff ${100*ve.value}%)`})),me.addEventListener("click",(function(){le.muted=!le.muted,le.muted?(ve.setAttribute("data-volume",ve.value),ve.value=0,ve.style.background="linear-gradient(to right, #c1ff06, 0%,  #c1ff06, 0%, #ffffff 0%)"):(ve.value=ve.dataset.volume,ve.style.background=`linear-gradient(to right, #c1ff06, 0%,  #c1ff06, ${100*ve.value}%, #ffffff ${100*ve.value}%)`)})),le.addEventListener("volumechange",(function(){pe.forEach((e=>{e.classList.add("hidden")})),le.muted||0===le.volume?he.classList.remove("hidden"):le.volume>0&&le.volume<=.5?fe.classList.remove("hidden"):Se.classList.remove("hidden"),le.muted&&0===le.volume&&"0"===ve.dataset.volume&&(pe.forEach((e=>{e.classList.add("hidden")})),fe.classList.remove("hidden")),console.log(le.muted)})),le.addEventListener("ended",de),K.addEventListener("click",(function(){ae>0?ae--:ae=U.length-1,se()})),z.addEventListener("click",de),X.addEventListener("click",ie);const ye=document.querySelector(".todo-btn"),Le=document.querySelector(".todo-widget-container"),we=document.querySelector(".todo-input"),Ee=document.querySelector(".todo-add-new-btn"),Ie=document.querySelector(".todo-list"),qe=document.querySelector(".todo-description");ye.addEventListener("click",(()=>{Le.classList.contains("active")?Le.classList.remove("active"):(Le.classList.add("active"),Te())}));let be=localStorage.getItem("todoId")?+localStorage.getItem("todoId"):0,ke=JSON.parse(localStorage.getItem("todo"))?JSON.parse(localStorage.getItem("todo")):[],$e=JSON.parse(localStorage.getItem("todoDone"))?JSON.parse(localStorage.getItem("todoDone")):[],xe=JSON.parse(localStorage.getItem("todoNone"))?JSON.parse(localStorage.getItem("todoNone")):[],Ae=localStorage.getItem("selectTodoItem1")?localStorage.getItem("selectTodoItem1"):"all";function Te(){0===ke.length?(qe.style.display="block",Ee.style.display="inline-block",we.style.display="none"):(qe.style.display="none",we.style.display="block")}Ee.addEventListener("click",(e=>{we.style.display="block",e.target.style.display="none"}));class Ce{constructor(e,t,n){this.id=e,this.title=t,this.completed=n}}const Me=document.querySelector("#list2");let Ne=[{value:"all",text:"All",length:ke.length,checked:!0},{value:"done",text:"Done",length:xe.length,checked:!1},{value:"none",text:"Not yet",length:$e.length,checked:!1}];function Oe(e){Ie.innerHTML="",e.length>0&&e.forEach((e=>{(e=>{const t=document.createElement("li");t.classList.add("todo-items");const n=document.createElement("input");n.type="checkbox",n.id=e.id,n.classList.add("todo-check"),n.checked=e.completed,t.append(n),n.addEventListener("change",Pe);const o=document.createElement("span");o.classList.add("checkmark"),t.append(o);const a=document.createElement("div");a.id=`b${e.id}`,a.contentEditable="false",a.innerText=e.title,a.classList.add("todo-val-input"),a.addEventListener("input",Ge),a.addEventListener("keypress",(e=>{13===e.which&&(a.contentEditable="false")}));const l=document.createElement("label");l.classList.add("todo-label"),l.appendChild(a),t.append(l);const c=document.createElement("button");c.id=`c${e.id}`,c.classList.add("todo-button","todo-del"),t.append(c),c.addEventListener("click",Ye);const r=document.createElement("button");r.id=`d${e.id}`,r.classList.add("todo-button","todo-edit"),t.append(r),r.addEventListener("click",We),Ie.prepend(t)})(e)}))}Ne.forEach((e=>{!function(e){const t=document.createElement("input");t.classList.add("selectopt"),t.type="radio",t.name="todo-item",t.value=e.value,t.id=e.value,t.setAttribute("checked",e.check),Me.append(t);const n=document.createElement("label");n.classList="select-option",n.setAttribute("for",e.value),n.id=`lab-${e.value}`,n.innerText=e.text;const o=document.createElement("span");o.classList.add("count"),o.innerText=e.length,n.appendChild(o),Me.append(n)}(e)}));const He=document.querySelector("form");function Je(){"all"==Ae?Oe(ke):"done"==Ae?Oe($e):"none"==Ae&&Oe(xe)}function je(){$e=ke.filter((e=>1==e.completed))}function De(){xe=ke.filter((e=>0==e.completed))}function Re(){Ne[0].length=ke.length,document.querySelector("#lab-all span").innerText=Ne[0].length,Ne[1].length=$e.length,document.querySelector("#lab-done span").innerText=Ne[1].length,Ne[2].length=xe.length,document.querySelector("#lab-none span").innerText=Ne[2].length}function Ge(){ke.find((e=>e.id==this.id.slice(1))).title=this.innerText.trim(),je(),De(),_e()}function We(){const e=document.querySelectorAll(".todo-val-input");let t=Array.from(e).find((e=>e.id.slice(1)==this.id.slice(1)));t.contentEditable="true",t.focus()}function Pe(){let e=ke.find((e=>e.id==this.id));e.completed=!e.completed,je(),De(),Re(),_e(),Je()}function Ye(){ke=ke.filter((e=>e.id!=this.id.slice(1))),je(),De(),Re(),_e(),Je(),Te()}function _e(){localStorage.setItem("todo",JSON.stringify(ke)),localStorage.setItem("todoDone",JSON.stringify($e)),localStorage.setItem("todoNone",JSON.stringify(xe))}He.elements["todo-item"].value=Ae,He.addEventListener("change",(e=>(Ae=e.target.value,"all"===e.target.value?(localStorage.setItem("selectTodoItem1","all"),Oe(ke)):"done"===e.target.value?(localStorage.setItem("selectTodoItem1","done"),Oe($e)):"none"===e.target.value&&(localStorage.setItem("selectTodoItem1","none"),Oe(xe)),Ae))),Je(),je(),De(),Re(),we.addEventListener("keypress",(e=>{if(13===e.which&&""!==we.value){be+=1,localStorage.setItem("todoId",be);let e=!1;e="done"==Ae,ke.push(new Ce(be,we.value,e)),je(),De(),Re(),_e(),Je(),Te(),we.value=""}})),window.addEventListener("beforeunload",_e),window.addEventListener("load",(function(){localStorage.getItem("todo")&&(ke=JSON.parse(localStorage.getItem("todo"))),localStorage.getItem("todoDone")&&($e=JSON.parse(localStorage.getItem("todoDone"))),localStorage.getItem("todoNone")&&(xe=JSON.parse(localStorage.getItem("todoNone"))),localStorage.getItem("selectTodoItem1")&&(Ae=JSON.parse(localStorage.getItem("selectTodoItem1")))})),localStorage.clear(),document.querySelectorAll('[name="radio-lng"]').forEach((t=>{t.addEventListener("change",(t=>{r.language=t.target.value,e(r.language),m(r.language),p(r.language),J(r.language),Q(r.language),d(r.language),s(r.language),""!==E.textContent&&$(r.language)})),t.value===localStorage.getItem("language")&&(t.checked=!0)})),document.querySelectorAll('[name="widget-img"]').forEach((e=>{e.addEventListener("change",(e=>{r.photoSource=e.target.value,q(),b()})),e.value===localStorage.getItem("photoSource")&&(e.checked=!0)})),e(r.language),t(),setInterval((function(){t()}),1e3),m(r.language),window.addEventListener("beforeunload",(function(){localStorage.setItem("name",g.value)})),window.addEventListener("load",(function(){localStorage.getItem("name")&&(g.value=localStorage.getItem("name"))})),p(r.language),b(),J(r.language),document.querySelector(".change-quote").addEventListener("click",(e=>{var t;e.target.classList.toggle("active"),t=r.language,x++,x===A&&(x=0),O.then((e=>{H(t,e)}))})),Q(r.language),n.addEventListener("click",(e=>{e.target.classList.toggle("active"),o.classList.contains("active")?o.classList.remove("active"):o.classList.add("active")})),d(r.language),window.addEventListener("beforeunload",(function(){localStorage.setItem("language",r.language),localStorage.setItem("photoSource",r.photoSource),localStorage.setItem("panels",JSON.stringify(r.panels))})),window.addEventListener("load",(function(){localStorage.getItem("language")&&(r.language=localStorage.getItem("language")),localStorage.getItem("photoSource")&&(r.photoSource=localStorage.getItem("photoSource")),localStorage.getItem("panels")&&(r.panels=JSON.parse(localStorage.getItem("panels")))})),s(r.language)})();